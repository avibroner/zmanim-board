<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>לוח זמני היום - קומפקטי</title>
    <style>
        body {
            background-color: #121212;
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 10px; /* צמצום שוליים חיצוניים */
            display: flex;
            justify-content: center;
        }

        .zmanim-board {
            width: 100%;
            max-width: 320px; /* הקטנת הרוחב מ-500 ל-320 */
            background-color: #1e1e1e;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            overflow: hidden;
            border: 1px solid #daa520; /* מסגרת עדינה יותר */
        }

        .header {
            background-color: #2c2c2c;
            text-align: center;
            padding: 10px; /* פחות מרווח בכותרת */
            border-bottom: 1px solid #444;
        }

        #hebrew-date {
            font-size: 1.3em; /* הקטנת גופן כותרת */
            font-weight: bold;
            color: #daa520;
            margin-bottom: 2px;
        }

        #gregorian-date {
            font-size: 0.85em; /* הקטנת תאריך לועזי */
            color: #aaaaaa;
        }

        #parasha {
            font-size: 0.9em;
            color: #8faae8;
            margin-top: 4px;
            font-weight: bold;
        }

        .zmanim-list {
            padding: 0;
            margin: 0;
            list-style: none;
        }

        .zman-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px; /* צמצום משמעותי של המרווחים בין השורות */
            border-bottom: 1px solid #333;
            font-size: 0.95em; /* הקטנת גופן הטקסט ברשימה */
            align-items: center;
        }

        .zman-item:last-child {
            border-bottom: none;
        }

        .zman-label {
            color: #e0e0e0;
        }

        .zman-time {
            font-weight: bold;
            color: #4db6ac;
        }

        /* עיצוב מיוחד למנחה - מותאם לגודל הקטן */
        .special-mincha {
            background-color: rgba(218, 165, 32, 0.15);
            border-top: 1px solid #daa520;
            border-bottom: 1px solid #daa520;
            padding: 10px 12px; 
        }
        
        .special-mincha .zman-label {
            color: #ffeb3b;
            font-weight: bold;
            font-size: 1em;
        }

        .special-mincha .zman-time {
            color: #ffffff;
            font-size: 1.1em;
            text-shadow: 0 0 3px #daa520;
        }
        
        .loading {
            text-align: center;
            padding: 15px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>

<div class="zmanim-board">
    <div class="header">
        <div id="hebrew-date">טוען...</div>
        <div id="parasha"></div>
        <div id="gregorian-date"></div>
    </div>
    <ul class="zmanim-list" id="zmanim-container">
        <li class="loading">טוען נתונים...</li>
    </ul>
</div>

<script>
    // מזהה העיר קרית אתא
    const CITY_ID = '293845'; 

    // הגדרת דקות לפני שקיעה למנחה
    const MINCHA_MINUTES_BEFORE_SUNSET = 20;

    const labels = {
        'sunrise': 'נץ החמה',
        'sofZmanShma': 'סוף זמן ק"ש (גר"א)',
        'sofZmanTfila': 'סוף זמן תפילה',
        'chatzot': 'חצות היום',
        'minchaGedola': 'מנחה גדולה',
        'plagHaMincha': 'פלג המנחה',
        'specialMincha': 'מנחה', // טקסט קצר יותר
        'sunset': 'שקיעה',
        'tzeit7083deg': 'צאת הכוכבים'
    };

    const displayOrder = [
        'sunrise',
        'sofZmanShma',
        'sofZmanTfila',
        'chatzot',
        'minchaGedola',
        'plagHaMincha',
        'specialMincha',
        'sunset',
        'tzeit7083deg'
    ];

    async function fetchZmanim() {
        try {
            const today = new Date().toISOString().split('T')[0];
            const url = `https://www.hebcal.com/zmanim?cfg=json&geonameid=${CITY_ID}&date=${today}`;
            
            const response = await fetch(url);
            const data = await response.json();

            updateDisplay(data);
        } catch (error) {
            console.error('Error fetching data:', error);
            document.getElementById('zmanim-container').innerHTML = '<li style="text-align:center; padding:10px; color:red">שגיאה</li>';
        }
    }

    function formatTime(dateObj) {
        return dateObj.toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit', hour12: false });
    }

    function formatIsoTime(isoString) {
        if (!isoString) return '--:--';
        return formatTime(new Date(isoString));
    }

    function updateDisplay(data) {
        fetch(`https://www.hebcal.com/converter?cfg=json&date=${data.date}&g2h=1&strict=1`)
            .then(res => res.json())
            .then(hebrewData => {
                document.getElementById('hebrew-date').innerText = hebrewData.hebrew;
                const gregDate = new Date(data.date);
                document.getElementById('gregorian-date').innerText = gregDate.toLocaleDateString('he-IL', { weekday: 'long', day: 'numeric', month: 'numeric' }); // תאריך לועזי מקוצר
            });

        const container = document.getElementById('zmanim-container');
        container.innerHTML = '';

        displayOrder.forEach(key => {
            let timeText = '';
            let isSpecial = false;

            if (key === 'specialMincha' && data.times.sunset) {
                const sunsetTime = new Date(data.times.sunset);
                const minchaTime = new Date(sunsetTime.getTime() - MINCHA_MINUTES_BEFORE_SUNSET * 60000);
                timeText = formatTime(minchaTime);
                isSpecial = true;
            } else if (data.times[key]) {
                timeText = formatIsoTime(data.times[key]);
            }

            if (timeText) {
                const li = document.createElement('li');
                li.className = 'zman-item';
                
                if (isSpecial) {
                    li.classList.add('special-mincha');
                }
                
                const nameSpan = document.createElement('span');
                nameSpan.className = 'zman-label';
                nameSpan.innerText = labels[key] || key;
                
                const timeSpan = document.createElement('span');
                timeSpan.className = 'zman-time';
                timeSpan.innerText = timeText;

                li.appendChild(nameSpan);
                li.appendChild(timeSpan);
                container.appendChild(li);
            }
        });
    }

    fetchZmanim();
</script>

</body>
</html>
